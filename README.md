Наворотил, что смог. Проще было переопределить методы в классах, но я, наверное, максимально усложнил себе задачу. Знаю, что код отвратителен, но в этом вроде и был смысл первого Д.З.?
